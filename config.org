#+TITLE: My Emacs Configuration
#+AUTHOR: Jack Hunt
#+OPTIONS: num:nil

* Straight Setup
Really, it would make more sense intuitively for this to be further down,
but it's easier to just make sure the package management stuff is dealt
with up front before proceeding when this is written out and executed.
** Bootstrap
#+BEGIN_SRC emacs-lisp
  (defvar bootstrap-version)
  (let ((bootstrap-file
         (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory))
        (bootstrap-version 5))
    (unless (file-exists-p bootstrap-file)
      (with-current-buffer
          (url-retrieve-synchronously
           "https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el"
           'silent 'inhibit-cookies)
        (goto-char (point-max))
        (eval-print-last-sexp)))
    (load bootstrap-file nil 'nomessage))

  (straight-use-package 'use-package)
#+END_SRC

** Configure =use-package=
#+BEGIN_SRC emacs-lisp
  (use-package straight
    :custom
    (straight-use-package-by-default t))
#+END_SRC

** Setup Package Updates
#+BEGIN_SRC emacs-lisp
  (use-package auto-package-update
    :custom
    (auto-package-update-interval 7)
    (auto-package-update-prompt-before-update t)
    (auto-package-update-hide-results t)
    :config
    (auto-package-update-maybe)
    (auto-package-update-at-time "11:00"))
#+END_SRC

** Mac Specific Env Setup
#+BEGIN_SRC emacs-lisp
  (use-package exec-path-from-shell
    :config
    (when (memq window-system '(mac ns x))
      (exec-path-from-shell-initialize)))
#+END_SRC

* General Setup
** UI Behaviour
#+BEGIN_SRC emacs-lisp
  (when (display-graphic-p)
    (setq inhibit-startup-message t)
    (scroll-bar-mode -1)
    (tool-bar-mode -1)
    (tooltip-mode -1)
    (set-fringe-mode 10)
    (menu-bar-mode -1)
    (global-hl-line-mode))
#+END_SRC

** Font
#+BEGIN_SRC emacs-lisp
  (set-face-attribute 'default nil :font "Fira Code Retina" :height 110)
#+END_SRC

** Unmap =C-[=
=C-[= maps to =ESC=, which is annoyingly close to =C-p=, meaning it's easy
to accidentally close all windows.
#+BEGIN_SRC emacs-lisp
  (global-unset-key (kbd "ESC ESC ESC"))
#+END_SRC

** General Editor Setup
#+BEGIN_SRC emacs-lisp
  ;; Match parens, quotations etc.
  (electric-pair-mode 1)

  ;; Nuke trailing whitespace on save.
  (add-hook 'before-save-hook (lambda () (delete-trailing-whitespace)))

  ;; Tabs are evil.
  (setq-default indent-tabs-mode nil)
  (setq-default tab-width 4)
  (setq indent-line-function #'insert-tab)

  ;; Don't store backup files with sources - it's a pain with git.
  (setq backup-directory-alist
        `(("." . , (expand-file-name "backups" temporary-file-directory))))

  ;; Ditto for autosaves.
  (setq auto-save-file-name-transforms `((".*" , temporary-file-directory t)))

  ;; Line & column numbers. Disabled for org & term.
  (column-number-mode)
  (global-display-line-numbers-mode t)

  (dolist (mode '(org-mode-hook
                  term-mode-hook
                  shell-mode-hook
                  eshell-mode-hook))
    (add-hook mode (lambda () (display-line-numbers-mode 0))))
#+END_SRC

** Mac Specific
#+BEGIN_SRC emacs-lisp
  (if (eq system-type 'darwin)
      (global-set-key (kbd "M-3") #'(lambda () (interactive) (insert "#"))))
#+END_SRC

** Helper Functions
TODO: Update this to regenerate from org
#+BEGIN_SRC emacs-lisp
  (defun jh/reload-config ()
    "Reload .emacs.d/init.el"
    (interactive)
    (load-file "~/.emacs.d/init.el"))
#+END_SRC

* Environment Setup
** Mac Specific
#+BEGIN_SRC emacs-lisp
  (if (eq system-type 'darwin)
      (setenv "PATH" (concat (getenv "PATH") ":/usr/texbin"))
    (setenv "PATH" (concat (getenv "PATH") ":/usr/bin"))
    (setenv "PATH" (concat (getenv "PATH") ":/usr/local/bin"))
    (setq exec-path (append exec-path '("/usr/texbin")))
    (setq exec-path (append exec-path '("/usr/bin")))
    (setq exec-path (append exec-path '("/usr/local/bin"))))
#+END_SRC

* Prettifying
** Theme
#+BEGIN_SRC emacs-lisp
  ;; doom-acario-dark
  ;; doom-badger
  ;; doom-dracula
  (use-package doom-themes
    :init
    (load-theme 'doom-city-lights t))
#+END_SRC

** Colourful Delimiters
#+BEGIN_SRC emacs-lisp
  (use-package rainbow-delimiters
    :hook
    (prog-mode . rainbow-delimiters-mode))
#+END_SRC

** Indent Highlighting
#+BEGIN_SRC emacs-lisp
  (use-package highlight-indent-guides
    :hook
    (prog-mode . highlight-indent-guides-mode)
    :custom
    (highlight-indent-guides-method 'bitmap))
#+END_SRC

** Fancy Modeline
#+BEGIN_SRC emacs-lisp
  (use-package doom-modeline
    :init
    (doom-modeline-mode 1)
    :custom
    ((doom-modeline-height 20)))
#+END_SRC

** Fancy Icons
#+BEGIN_SRC emacs-lisp
  (use-package nerd-icons
    :hook
    (dired-mode . nerd-icons-dired-mode))
#+END_SRC

** Ligatures
#+BEGIN_SRC emacs-lisp
  (use-package ligature
    :config
    (ligature-set-ligatures 'prog-mode '("www" "**" "***" "**/" "*>" "*/" "\\\\" "\\\\\\" "{-" "::"
                                         ":::" ":=" "!!" "!=" "!==" "-}" "----" "-->" "->" "->>"
                                         "-<" "-<<" "-~" "#{" "#[" "##" "###" "####" "#(" "#?" "#_"
                                         "#_(" ".-" ".=" ".." "..<" "..." "?=" "??" ";;" "/*" "/**"
                                         "/=" "/==" "/>" "//" "///" "&&" "||" "||=" "|=" "|>" "^=" "$>"
                                         "++" "+++" "+>" "=:=" "==" "===" "==>" "=>" "=>>" "<="
                                         "=<<" "=/=" ">-" ">=" ">=>" ">>" ">>-" ">>=" ">>>" "<*"
                                         "<*>" "<|" "<|>" "<$" "<$>" "<!--" "<-" "<--" "<->" "<+"
                                         "<+>" "<=" "<==" "<=>" "<=<" "<>" "<<" "<<-" "<<=" "<<<"
                                         "<~" "<~~" "</" "</>" "~@" "~-" "~>" "~~" "~~>" "%%"))
    (global-ligature-mode t))
#+END_SRC

** Idle Highlighting
#+BEGIN_SRC emacs-lisp
  (use-package idle-highlight-mode
    :config
    (setq idle-highlight-idle-time 0.2)
    :hook
    ((prog-mode text-mode) . idle-highlight-mode))
#+END_SRC

* Apps
** Learning and Typing
#+BEGIN_SRC emacs-lisp
  (use-package speed-type)

  (use-package key-quiz)
#+END_SRC

** Dashboard
#+BEGIN_SRC emacs-lisp
  (use-package dashboard
    :if (< (length command-line-args) 2) ;; Skip if opening file with emacs
    :config
    (dashboard-setup-startup-hook)
    (setq initial-buffer-choice
          (lambda () (get-buffer-create "*dashboard*")))
    (setq dashboard-center-content t)
    (setq dashboard-items '((recents  . 10)
                            (projects . 10)
                            (registers . 10)))
    (setq dashboard-icon-type 'nerd-icons)
    (setq dashboard-set-heading-icons t)
    (setq dashboard-set-file-icons t)
    (setq dashboard-heading-icons '((recents   . "history")
                                    (projects  . "rocket")
                                    (registers . "database"))))
#+END_SRC

** GitHub Copilot
#+BEGIN_SRC emacs-lisp
  (use-package copilot
    :straight (:host github :repo "copilot-emacs/copilot.el" :files ("*.el"))
    :bind
    (:map copilot-completion-map
          ("<tab>" . copilot-accept-completion)
          ("TAB" . copilot-accept-completion))
    :hook
    (prog-mode . copilot-mode))
#+END_SRC
